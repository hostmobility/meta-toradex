inherit kernel
require recipes-kernel/linux/linux.inc

LINUX_VERSION ?= "2.6.36.2"

SRCREV = "99003b6bd73fd8ce4f2bd63a1c7b63f8c3d0cf68"

PV = "2.6.36.2+gitr${SRCREV}"
PR = "V1.0b6"
S = "${WORKDIR}/git"
SRC_URI = "\
  git://gitorious.org/colibri-t20-embedded-linux-bsp/colibri_t20-linux-kernel.git;protocol=git;branch=master \
  file://bcm4329_warning.patch \
"

#SVN_REV = 217
#PV = "2.6.36.3"
#PR = "${SVN_REV}"
#S = "${WORKDIR}/linux-nv-tegra"
#SRC_URI = "svn://tegradev:tegra123!@mammut.toradex.int:8090/colibri_tegra_linux/trunk;module=kernel;rev=${SVN_REV};proto=http \
#SRC_URI = "svn://tegradev:tegra123!@mammut.toradex.int:8090/colibri_tegra_linux/branches;module=linux-nv-tegra;rev=${SVN_REV};proto=http \
	"

COMPATIBLE_MACHINE = "colibri-t30"

CMDLINE="mem=148M@0M nvmem=96M@160M vmalloc=248M video=tegrafb root=/dev/nfs ip=:::::eth0:on rw netdevwait mtdparts=tegra_nand:1018368K@28160K(userspace) console=ttyS0,115200n8 usb_high_speed=0"

do_configure_prepend_colibri-t30() {
	#use the defconfig provided in the kernel source tree
	#install -m 0644 ${S}/arch/arm/configs/colibri_t30_defconfig ${WORKDIR}/defconfig
	install -m 0644 ${S}/arch/arm/configs/colibri_t20_defconfig ${WORKDIR}/defconfig
	#compile with -O2, 4.5. compiler seems to fail with -Os
#	sed -i -e /CONFIG_CC_OPTIMIZE_FOR_SIZE/d ${WORKDIR}/defconfig
#	echo "CONFIG_CC_OPTIMIZE_FOR_SIZE=n" >> ${WORKDIR}/defconfig
}

#require recipes-kernel/linux/linux-tools.inc

